<style>
  #rotate-button {
    position: fixed;
    z-index: 9999;
    pointer-events: auto;
    touch-action: manipulation;
  }

  /* Prevent XR overlays from eating touches */
  .xrextras-ui,
  .coaching-overlay,
  .landing-page {
    pointer-events: none;
  }
</style>

<button id="rotate-button">Turn On</button>

<!-- QR Code for desktop users -->
<div id="qr-code-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.95); z-index: 10000; flex-direction: column; align-items: center; justify-content: center; padding: 20px;">
  <h1 style="margin-bottom: 30px; font-family: Helvetica, Arial, sans-serif; color: #333;">Open on Mobile</h1>
  <canvas id="qr-code-canvas"></canvas>
  <p style="margin-top: 30px; font-family: Helvetica, Arial, sans-serif; color: #666; text-align: center; max-width: 500px;">
    Scan this QR code with your mobile device to view the interactive 3D CT Scanner.
  </p>
  <p style="margin-top: 20px; font-family: 'Courier New', monospace; color: #999; text-align: center; max-width: 600px; font-size: 0.9em;">
    Latest update: style: make buttons pill-shaped with semicircular ends
  </p>
</div>

<div id="popup" class="popup" style="display: none">
  <div id="popup-title" class="popuptitle"></div>
  <div id="popup-content-wrapper" class="popup-content-wrapper">
    <div id="popup-content" class="popup-content">
      <div id="popup-image"></div>
    </div>
  </div>
  <div class="popup-close-icon">
    <span id="close-popup">&#10006;</span>
  </div>
  <div class="button-container">
    <div id="backbutton" style="display: none; z-index: 200">
      <h2>Back</h2>
    </div>
    <div id="nextbutton" style="display: none; z-index: 200">
      <h2>Next</h2>
    </div>
  </div>
</div>

<a-scene
  environment="preset: default; lighting: point; shadow: true"
  coaching-overlay
  enable-interaction-immediate
  next-button
  rotate-button
  selectcomponent
  xrextras-gesture-detector
  landing-page
  xrextras-loading
  xrextras-runtime-error
  renderer="colorManagement: true; physicallyCorrectLights: true; exposure: 1.6"
  xrweb="allowedDevices: any;
          defaultEnvironmentFogIntensity: 0.3;
          defaultEnvironmentFloorTexture: #groundTex;
          defaultEnvironmentFloorColor: #ffffff;
          defaultEnvironmentSkyBottomColor: #e6f2ff;
          defaultEnvironmentSkyTopColor: #ffffff;
          defaultEnvironmentSkyGradientStrength: 1;
          scale: absolute">
  <a-assets>
    <img id="hospital_env" src="assets/hospital_env.jpg" crossorigin="anonymous" />
    <a-asset-item id="gantry_housing_asset" src="assets/gantry_housing.glb"></a-asset-item>
    <a-asset-item id="gantry_ring_asset" src="assets/gantry_ring.glb"></a-asset-item>
    <a-asset-item id="xray_tube_asset" src="assets/xray_tube.glb"></a-asset-item>
    <a-asset-item id="detector_array_asset" src="assets/detector_array.glb"></a-asset-item>
    <a-asset-item id="slip_ring_assembly_asset" src="assets/slip_ring_assembly.glb"></a-asset-item>
    <a-asset-item id="collimators_asset" src="assets/collimators.glb"></a-asset-item>
    <a-asset-item id="bore_asset" src="assets/bore.glb"></a-asset-item>
    <a-asset-item id="patient_table_asset" src="assets/patient_table.glb"></a-asset-item>
    <a-asset-item id="control_console_asset" src="assets/control_console.glb"></a-asset-item>
    <a-asset-item
      id="image_reconstruction_computer_asset"
      src="assets/image_reconstruction_computer.glb"></a-asset-item>
    <a-asset-item id="cooling_system_asset" src="assets/cooling_system.glb"></a-asset-item>
    <a-asset-item
      id="laser_positioning_lights_asset"
      src="assets/laser_positioning_lights.glb"></a-asset-item>
    <a-asset-item
      id="safety_and_intercom_systems_asset"
      src="assets/safety_and_intercom_systems.glb"></a-asset-item>
  </a-assets>

  <!-- Camera with raycaster for tap interactions -->
  <a-camera
    id="camera"
    position="4 1 0"
    rotation="0 90 0"
    raycaster="objects: .cantap, .interactable"
    cursor="rayOrigin: mouse; fuse: false">
  </a-camera>

  <!-- Lights -->
  <a-entity
    light="type: directional; intensity: 1.2; castShadow: true; shadowMapHeight: 2048; shadowMapWidth: 2048; shadowRadius: 1; shadowBias: -0.0001; target: #group"
    xrextras-attach="target: group; offset: -8 15 4"
    position="-20 20 20">
  </a-entity>
  <a-light type="ambient" intensity="0.4" color="#ffffff"></a-light>

  <a-entity
    light="type: hemisphere;
         intensity: 0.6;
         groundColor: #dddddd;
         color: #ffffff">
  </a-entity>

  <a-entity
    light="type: directional;
          intensity: 2.5;
          color: #ffffff"
    position="6 0 6">
  </a-entity>

  <!-- Main manipulatable group -->
  <a-entity
    id="group"
    scale="1 1 1"
    clamp-group
    xrextras-gesture-detector
    xrextras-two-finger-rotate
    xrextras-pinch-scale>
    <!-- Rotation pivot (optional, you can keep it for organization) -->
    <a-entity id="rotation_pivot" position="0 0 0">
      <a-entity id="xray_tube" gltf-model="#xray_tube_asset" class="cantap rotatable interactable" shadow="cast: true; receive: true">
      </a-entity>

      <a-entity
        id="detector_array"
        gltf-model="#detector_array_asset"
        class="cantap rotatable interactable"
        shadow="cast: true; receive: true"
        metallic>
      </a-entity>

      <a-entity
        id="collimators"
        gltf-model="#collimators_asset"
        class="cantap rotatable interactable"
        shadow="cast: true; receive: true"
        metallic>
      </a-entity>
    </a-entity>

    <!-- Other models now also respond to gestures -->
    <a-entity id="gantry_housing" gltf-model="#gantry_housing_asset" class="cantap interactable" shadow="cast: true; receive: true">
    </a-entity>

    <a-entity id="gantry_ring" gltf-model="#gantry_ring_asset" class="cantap interactable" shadow="cast: true; receive: true">
    </a-entity>

    <a-entity
      id="slip_ring_assembly"
      gltf-model="#slip_ring_assembly_asset"
      class="cantap interactable"
      shadow="cast: true; receive: true"
      slip-ring-assembly-metal>
    </a-entity>

    <a-entity id="bore" gltf-model="#bore_asset" class="cantap interactable" shadow="cast: true; receive: true"></a-entity>
    <a-entity
      id="patient_table"
      gltf-model="#patient_table_asset"
      class="cantap interactable"
      shadow="cast: true; receive: true"
      fabric></a-entity>
    <a-entity
      id="control_console"
      gltf-model="#control_console_asset"
      class="cantap interactable"
      shadow="cast: true; receive: true"></a-entity>
    <a-entity
      id="image_reconstruction_computer"
      gltf-model="#image_reconstruction_computer_asset"
      class="cantap interactable"
      shadow="cast: true; receive: true"
      dark-plastic>
    </a-entity>
    <a-entity
      id="cooling_system"
      gltf-model="#cooling_system_asset"
      class="cantap interactable"
      shadow="cast: true; receive: true"
      fabric>
    </a-entity>
    <a-entity
      id="laser_positioning_lights"
      gltf-model="#laser_positioning_lights_asset"
      class="cantap interactable"
      shadow="cast: true; receive: true"
      dark-plastic>
    </a-entity>
    <a-entity
      id="safety_and_intercom_systems"
      gltf-model="#safety_and_intercom_systems_asset"
      class="cantap interactable"
      shadow="cast: true; receive: true"></a-entity>
  </a-entity>

  <!-- Ground -->
  <a-plane
    id="ground"
    rotation="-90 0 0"
    position="0 -200 0"
    width="1000"
    height="1000"
    material="shader: shadow"
    shadow="receive: true">
  </a-plane>
</a-scene>
